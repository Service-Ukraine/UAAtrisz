let paginationDataMap=new Map,replaceTextContent=!1,renderImgContent=!1,stylesMap=new Map,dataTablePaginationDataMap=new Map,dataTableStylesMap=new Map;function getNumberOfPages(e,t){return Math.ceil(e/t)}function uuidv4(){return"xxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}const findComponentIndex=(t,a)=>{return Object.keys(t).findIndex(e=>t[e].getAttribute("data-gjs")===a)},createContentPlaceholder=(t,a,r)=>{let n="";var l=r.includes("list-group-item"),e=localStorage.getItem("loadingIconKey");if(e&&"PLACEHOLDER"!==e)"PLAIN_SPINNER"===e?n=`<div class="drapcode-spinner-plane ${a}-placeholder"></div>`:"CHASE_SPINNER"===e?n=`<div class="sk-chase ${a}-placeholder"><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div></div>`:"BAR_SPINNER"===e?n=`<div class="drapcode-spinner-bar ${a}-placeholder"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div>`:"DOT_SPINNER"===e?n=`<div class="drapcode-spinner-dot ${a}-placeholder"><div class="dot1"></div><div class="dot2"></div></div>`:"FADING_CIRCLE_SPINNER"===e?n=`<div class="sk-fading-circle ${a}-placeholder"><div class="sk-circle1 sk-circle"></div><div class="sk-circle2 sk-circle"></div><div class="sk-circle3 sk-circle"></div><div class="sk-circle4 sk-circle"></div><div class="sk-circle5 sk-circle"></div><div class="sk-circle6 sk-circle"></div><div class="sk-circle7 sk-circle"></div><div class="sk-circle8 sk-circle"></div><div class="sk-circle9 sk-circle"></div><div class="sk-circle10 sk-circle"></div><div class="sk-circle11 sk-circle"></div><div class="sk-circle12 sk-circle"></div></div>`:"BOUNCE_SPINNER"===e?n=`<div class="drapcode-spinner-bounce ${a}-placeholder"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>`:"NONE"===e&&(n="");else for(let e=0;e<t;e++)n+=l?`<div class="${r} ${a}-placeholder"><div class="drapcode-col-12"><div class="drapcode-row"><div class="drapcode-col-4"></div><div class="drapcode-col-4"></div><div class="drapcode-col-6"></div></div></div></div>`:`<div class="drapcode-item ${r} ${a}-placeholder"><div class="drapcode-col-12"><div class="drapcode-picture"></div><div class="drapcode-row"><div class="drapcode-col-6 big"></div><div class="drapcode-col-4 empty big"></div><div class="drapcode-col-2 big"></div><div class="drapcode-col-4"></div><div class="drapcode-col-8 empty"></div><div class="drapcode-col-6"></div><div class="drapcode-col-6 empty"></div><div class="drapcode-col-12"></div></div></div></div>`;return n},loadDataGroupItems=async(a,r)=>{var{finderId:n,collectionName:c,fieldName:u,numberPerPage:l,dataGroupChildren:i,externalQueryParamKeys:m,searchString:s}=a,e=findComponentIndex(i,"search-form"),t=i[e];const d=i;t&&t.length&&d[e].remove();e=createContentPlaceholder(l||1,d[0].id,d[0].className);r.innerHTML="";const o=document.createElement("div");o.classList.add("data-group-content"+elementAttribute(r,"id")),o.classList.add("row"),o.innerHTML=e,r.style.display="";l=i[findComponentIndex(i,"data-group-map")],t&&r.appendChild(t),l&&r.appendChild(l),r.appendChild(o),e=findComponentIndex(i,"pagination"),t=i[e];t&&r.appendChild(t),a.replacedElement=o,a.originalDataGroup=r;let p=!1;l=(await getPageItemData()).itemData;if(n){let e=`collection-table/${c}/finder/${n}/items/count?`,t=(e=prepareItemDataAndExternalQueryParam(m,e,l,r),await searchQueryStringFromUrl());void 0!==s&&s?e=t?(t.startsWith("?")&&(t=t.replace("?","&")),e+"&"+s+t):e+"&"+s:t&&(t.startsWith("?")&&(t=t.replace("?","&")),e+=t);i=await securedGetCall(e);a.numberOfPages=getNumberOfPages(i.data,a.numberPerPage),p=i?i._$isPrivateFilter:null}else if(u){e=parseValueFromData(l,u);a.numberOfPages=1,a.filteredItemsUrl=`collection-table/${c}/itemList`,a.itemIds=e}else{t=Object.fromEntries(new URLSearchParams(window.location.search));console.log("::::::searchQuery11:::::::",t);let e="";"externalId"in t&&(e=t.externalId),console.log("::::::::externalApiMiddlewareId:::::",e),a.filteredItemsUrl=`external-api-middleware/${e}/collection-items`}loadGroupData(a,p)};async function loadGroupData(e,c){var t,a,r,{numberPerPage:n,numberOfPages:u,filteredItemsUrl:m,dataGroupChildren:p,replacedElement:g,currentPage:v,searchString:l,originalDataGroup:i,itemIds:f,fieldName:s,collectionName:h,externalQueryParamKeys:b}=e;addPaginationDataToDataMap(e,i);let d=await searchQueryStringFromUrl(),o=m,y="";s||(e=(v-1)*n,s=(y=e,o=m+`?offset=${e}&limit=`+n,void 0!==l&&l?o=d?(d.startsWith("?")&&(d=d.replace("?","&")),o+"&"+l+d):o+"&"+l:d&&(d.startsWith("?")&&(d=d.replace("?","&")),o+=d),await getPageItemData())["itemData"],o=prepareItemDataAndExternalQueryParam(b,o,s,i)),await renderDataGroupItem(h,o,p,g,i,f,y,stylesMap,c),validatePaginationButton(u,v,i);for([t,a]of stylesMap)selectorExists(`[id^="${t}"]`)||(r=`*[id^="${t}"] `+a,addStyle(r))}const addPaginationDataToDataMap=async(e,t)=>{paginationDataMap.set("pdata_"+t.id,e)},renderDataGroupItem=async(e,t,a,r,n,l,i="",s,d)=>{let o=[];t&&(0<(o=l?Array.isArray(l)?l:0<Object.keys(l).length?[l]:[]:(await securedGetCall(t)).data).length?(renderMapData(o,n),renderData(e,o,a,r,i,s)):r.innerHTML=d?"<div class='col-md-12 text-center'>This data is private hence cannot be displayed</div>":"<div class='col-md-12 text-center'></div>")},elementSelector=(e,t)=>e.querySelector(t),validatePaginationButton=(e,t,a)=>{const r=elementSelector(a,".loadMore"),n=elementSelector(a,".next"),l=elementSelector(a,".previous"),i=elementSelector(a,".first"),s=elementSelector(a,".last");r&&(r.disabled=t===e),n&&(n.disabled=t===e),l&&(l.disabled=1===t),i&&(i.disabled=1===t),s&&(s.disabled=t===e)},renderMapData=(i,s)=>{Object.keys(s.children).forEach(e=>{const t=s.children[e];var a,r,n,l;"data-group-map"===elementAttribute(t,"data-gjs")&&(e=elementAttribute(t,"data-group-map-lat"),a=elementAttribute(t,"data-group-map-long"),r=elementAttribute(t,"data-group-map-header"),n=elementAttribute(t,"data-group-map-description"),l=t.id,t.innerHTML=`<div id="map-${l}" class="map"></div> <style>.map{
      height:100%;width:100%;
       }</style>`,l=new google.maps.Map(document.getElementById("map-"+l),{zoom:15,center:new google.maps.LatLng(Number(i[0][e]),Number(i[0][a]))}),0<i.length&&addMarkerInfo(i,l,e,a,r,n))})},renderData=(a,e,t,r,n="",l)=>{const i=t;return document.querySelectorAll(`.${t[0]&&"undefined"!==t[0]?t[0].id:""}-placeholder`).forEach(e=>e.remove()),e.forEach((e,t)=>{document.createElement("div");replaceContentOfItem(a,e,i,r,t,n,l)})},addMarkerInfo=(e,n,l,i,s,d)=>{let o=[];e.map(e=>{const t=new google.maps.Marker({position:new google.maps.LatLng({lat:Number(e[l]),lng:Number(e[i])}),map:n});let a="<div>";e[s]&&(a+=`<h6>${e[s]}</h6>`),e[d]&&(a+=`<p>${e[d]}</p>`),a+="</div>";const r=new google.maps.InfoWindow({content:a});t.addListener("click",function(){clearInfoClickReference(o),r.open(t.get("map"),t),o[0]=r})})},replaceContentOfItem=(b,y,A,T,D="",C="",I)=>{Object.keys(A).forEach(async t=>{const e=A[t];var a=elementAttribute(e,"data-gjs");if(!["pagination","search-form","data-group-map"].includes(a)){const r=e.cloneNode(!0);var a=elementAttribute(r,"id");a&&(D||C)&&(D&&r.setAttribute("id",a+"-"+t+D+"-"+uuidv4()),C&&(a=elementAttribute(r,"id"),r.setAttribute("id",a+"-"+C))),applyUserDefinedStyles(e,r,I);const{itemData:n,collectionId:l}=await getPageItemData(),i="data-"+l,s="data-url-"+l;if(0<e.children.length){t=r.children,a=(updateChildrenIds(t,r,I),r.querySelectorAll("[data-text-content]"));const d=r.querySelectorAll("[data-img-src]");let e=r.querySelectorAll("[data-path-collection-name]");const c=r.querySelectorAll('[data-gjs="marketplace-form"]'),u=r.querySelectorAll("[role='progressbar']"),m=r.querySelectorAll("a, button"),p=r.querySelectorAll("[data-href-content]"),g=r.querySelectorAll("form"),v=r.querySelectorAll("[data-ref-field]"),o=r.querySelectorAll(`[${i}], [data-filter-id]`),f=(console.log("textContentElements test :>> ",o),r.querySelectorAll(`[${s}]`)),h=r.querySelectorAll('[data-text-content][data-field-type="file"][data-href-content]');v.forEach(e=>{replaceInnerGroup(b,y,e,I)}),d.forEach(e=>{e.closest("[data-ref-field]")||renderImageFromDB(y,e,I)}),Object.values(a).map(e=>{e.closest("[data-ref-field]")||replaceContentOfTextContent(y,e,I)}),u.forEach(e=>{e.closest("[data-ref-field]")||replaceContentOfProgressBarContent(y,e)}),e.forEach(e=>{e.closest("[data-ref-field]")||replaceHrefOfHyperLinks(y,e)}),m.forEach(e=>{e.closest("[data-ref-field]")||addItemUuidIntoButtonAndLink(b,y,e)}),p.forEach(e=>{e.closest("[data-ref-field]")||replaceContentOfFieldURL(y,e)}),g.forEach(e=>{e.closest("[data-ref-field]")||replaceContentOfFormElements(y,e)}),c.forEach(e=>{addValueToMarketplaceCheck(b,y,e)}),o.forEach(e=>{var t,a=elementAttribute(e,i);a&&(t=elementAttribute(e,"data-field-type"),!(!(a=n[a]||"")||"large_text"!==t)&&htmlRegex.test(a)?e.innerHTML=a:e.textContent="boolean"===t?a?"Yes":"No":a),e.style.display="block"}),f.forEach(e=>{var t=elementAttribute(e,s);const a=elementAttribute(e,s);t=a.replace(t,n[t]);e.setAttribute("href",t)}),h.forEach(e=>{e.closest("[data-ref-field]")||replaceContentOfFileLinkElements(y,e)})}else replaceContentOfTextContent(y,r,I),renderImageFromDB(y,r,I),replaceHrefOfHyperLinks(y,r),replaceContentOfFieldURL(y,r),replaceContentOfFormElements(y,r);T.appendChild(r),addDynamicDataIntoFormElements(null,!1,T)}})},clearInfoClickReference=e=>{e.map(e=>{e.set("marker",null),e.close()})},applyUserDefinedStyles=(e,t,a)=>{var r=elementAttribute(e,"id"),n="#"+r,l=(elementAttribute(t,"id"),Array.from(document.styleSheets).filter(e=>!e.href||e.href.startsWith(window.location.origin)));for(let e=0;e<l.length;e++){var i=l[e].cssRules||l[e].rules;for(let e=0;e<i.length;e++){var s=i[e];if(s.selectorText===n){let t="";for(let e=0;e<s.style.length;e++)t+=`${s.style[e]}: ${s.style[s.style[e]]} !important;`;a.set(r,`{ ${t} }`)}}}},updateChildrenIds=(e,t,a)=>{var r;e[0].hasAttribute("id")&&(r=e[0].getAttribute("id"),applyUserDefinedStyles(e[0],t,a),e[0].setAttribute("id",r+"-"+uuidv4())),e[0].childNodes.forEach(e=>{e.attributes&&e.hasAttribute("id")&&updateInnerChildIds(e,t,a)})},replaceInnerGroup=(t,e,a,r)=>{const n=a.cloneNode(!0);a.innerHTML="";var l=elementAttribute(n,"data-ref-field");elementAttribute(n,"data-ref-collection");let i=l?parseValueFromData(e,l):[];i&&Array.isArray(i)?i.forEach(e=>{renderItemOfReferenceField(t,e,n,a,r)}):renderItemOfReferenceField(t,i,n,a,r)},renderImageFromDB=(a,r,n)=>{var l=elementAttribute(r,"data-img-src");elementAttribute(r,"data-field-type");if(l){let e=r.src,t=l?parseValueFromData(a,l):"";Array.isArray(t)&&(t=t[0]),renderImgContent?(a=r.cloneNode(!0),l=elementAttribute(r,"id")+"-"+uuidv4(),r.setAttribute("id",l),applyUserDefinedStyles(a,r,n)):renderImgContent=!0,t&&("object"==typeof t?(l=t.key,e=t.isExternalUrl?t.url:l?IMAGE_SERVER_URL+l:e):"string"==typeof t&&t.startsWith("http")&&(e=t),r.src=e)}},replaceContentOfTextContent=(t,a,r)=>{replaceTextContent?(l=a.cloneNode(!0),e=elementAttribute(a,"id"),a.setAttribute("id",e),applyUserDefinedStyles(l,a,r)):replaceTextContent=!0;let n=elementAttribute(a,"data-text-content");var e=elementAttribute(a,"data-field-type");if(n)if(n.includes('"')&&"functionType"in JSON.parse(n)){var l=getDerivedFieldData(n,t);/<\/?[a-z][\s\S]*>/i.test(l)?a.innerHTML=l:a.textContent=l}else{if("reference"===e||"multi_reference"===e||"belongsTo"===e){let e=(JSON.parse(elementAttribute(a,"metaData"))||{})["nestedFieldName"];e||(l=((r=t._$belongsToMetaData)?r.refCollection:{})["collectionField"],e=l||void 0),n.includes(".")||(n=n+"."+e)}r=parseValueFromData(t,n);if(r&&"large_text"===e)if(htmlRegex.test(r))return void(a.innerHTML=r);"boolean"!==e?a.textContent=r:a.textContent=r?"Yes":"No"}},replaceContentOfProgressBarContent=(e,t)=>{t=t.parentElement;const a=elementAttribute(t,"data-progress-now"),r=elementAttribute(t,"data-progress-min"),n=elementAttribute(t,"data-progress-max"),l=t.children[0];var i;a&&e[a]&&(a.includes('"')&&"functionType"in JSON.parse(a)?(i=getDerivedFieldData(a,e),t.setAttribute("data-progress-now",i),l.setAttribute("aria-valuenow",i),l.style.nowWidth=i+"%"):(t.setAttribute("data-progress-now",e[a]),l.setAttribute("aria-valuenow",e[a]),l.style.width=e[a]+"%")),r&&e[r]&&(r.includes('"')&&"functionType"in JSON.parse(r)?(i=getDerivedFieldData(r,e),t.setAttribute("data-progress-min",i),l.setAttribute("aria-valuemin",i),l.style.minWidth=i+"%"):(t.setAttribute("data-progress-min",e[r]),l.setAttribute("aria-valuemin",e[r]),l.style.minWidth=e[r]+"%")),n&&e[n]&&(n.includes('"')&&"functionType"in JSON.parse(n)?(i=getDerivedFieldData(n,e),t.setAttribute("data-progress-max",i),l.setAttribute("aria-valuemax",i),l.style.maxWidth=i+"%"):(t.setAttribute("data-progress-max",e[n]),l.setAttribute("aria-valuemax",e[n]),l.style.maxWidth=e[n]+"%"))},replaceHrefOfHyperLinks=async(a,r)=>{var n=elementAttribute(r,"data-path-field-name"),l=elementAttribute(r,"data-path-field-seo"),i=(elementAttribute(r,"id"),elementAttribute(r,"data-path-collection-item-id-from"));if(["pageCollection","session"].includes(i)&&(a="session"===i?(i=localStorage.getItem("user"))&&"undefined"!==i?JSON.parse(i):{}:(i=(await getPageItemData())["itemData"],i)),n){const s=elementAttribute(r,"href");let e=n?parseValueFromData(a,n):"",t=(e=(e=e&&e.length?e.split(", "):"")[0],s.replace(n,e));l&&(i=l?parseValueFromData(a,l):"",i=slugify(i),t=t.replace(l,i)),r.setAttribute("href",t)}},addItemUuidIntoButtonAndLink=(e,t,a)=>{a.setAttribute("data-item-id",t.uuid),a.setAttribute("data-collection-id",e);e=window.document.getElementById("snipcart");void 0!==e&&null!=e&&a.classList.contains("snipcart-add-item")&&loadSnipcartItemData(a,t)},replaceContentOfFieldURL=(e,t)=>{const a=elementAttribute(t,"data-href-content");elementAttribute(t,"id");var r=elementAttribute(t,"data-field-type");a&&"file"!==r&&(r=a.replace(a,parseValueFromData(e,a)),t.setAttribute("href",r))},replaceContentOfFormElements=(a,e)=>{const t=e.querySelectorAll("[data-form-element-data-group]");t.forEach(e=>{var t=elementAttribute(e,"data-form-element-data-group"),t=parseValueFromData(a,t);insertFormElementValue(t,e)})},addValueToMarketplaceCheck=(e,t,a)=>{var r=elementAttribute(a,"quantityfield"),n=elementAttribute(a,"pricefield"),l=elementAttribute(a,"namefield"),i=elementAttribute(a,"descriptionfield");a.elements["quantity-field"].value=r,a.elements["price-field"].value=n,a.elements.productId.value=t.uuid,a.elements.collectionName.value=e,a.elements["name-field"].value=l,a.elements["description-field"].value=i},updateInnerChildIds=(e,t,a)=>{var r;elementAttribute(e,"id")&&(r=elementAttribute(e,"id"),applyUserDefinedStyles(e,t,a),e.setAttribute("id",r+"-"+uuidv4())),e.childNodes.forEach(e=>{e.attributes&&e.hasAttribute("id")&&updateInnerChildIds(e,t,a)})},renderItemOfReferenceField=(e,t,a,r)=>{a=a.children;replaceContentOfItem(e,t,a,r,"","",stylesMap)},getDerivedFieldData=(e,t)=>{const a=JSON.parse(e);e=a.parentFieldName;let r="";return r=e?t[e].map(e=>prepareFunction(a,e)).join(", "):prepareFunction(a,t)},prepareFunction=(e,n)=>{let l,i,s,d,o,m,p,g,v,f,c="",u=[],t=localStorage.getItem("user");switch(t=t?JSON.parse(t):{},e.args.forEach(e=>{const{name:t,key:a}=e;"formatType"===t?l=a:"restToLower"===t?i=a:"whitespace"===t?s=a:"type"===t?o=a:"noSplitopt"===t?d=a:"length"===t?m=a:"endopt"===t?p=a:"startLength"===t?startLength=a:"endLength"===t?endLength=a:"startString"===t?g=a:"endString"===t?v=a:"separator"===t?f=a:"expression"===t&&(c=a);let r=[];["formatType","restToLower","whitespace","type","noSplitopt","length","endopt","startLength","endLength","startString","endString","separator","expression"].includes(t)||(Array.isArray(a)?(a.forEach(e=>{r.push(n[e])}),u.push(r)):u.push(n[a]))}),e.functionType){case"CAPITALIZE":return capitalize(u[0],i);case"LOWER_CASE":return lowerCase(u[0]);case"UPPER_CASE":return upperCase(u[0]);case"SLUGIFY":return slugify(u[0]);case"TRIM":return trim(u[0],s,o);case"TITLE_CASE":return titleCase(u[0],d);case"TRUNCATE":return truncate(u[0],m,p);case"SUB_STRING":return substr(u[0],startLength,endLength);case"STRING_JOIN":return strJoin(u[0],f,g,v);case"CUSTOM_SENTENCE":return evaluateCustomSentence(c,n,t);case"ADDITION":return addition(l,{numbers:u[0]});case"AVERAGE":return average(l,{numbers:u[0]});case"MULTIPLY":return multiply(l,{numbers:u[0]});case"DIVIDE":return divide(l,{number1:u[0],number2:u[1]});case"CUSTOM_CALCULATION":return evaluateExpression(c,n,t,l);case"CUSTOM_JS_LOGIC":case"CUSTOM_JAVASCRIPT_LOGIC":return evaluateJSLogic(c,n,t);case"SUBSTRACTION":return substraction(l,{numbers1:u[0],numbers2:u[1]});case"COUNT":return count(u[0]);case"FORMAT_DATE":var a=+document.getElementById("project-timezone").innerText||0;return formatDate(l,u[0],a);default:return""}};async function searchInDataGroup(e,t){e.replacedElement.innerHTML="";var t=t.target,{searchString:t,finderId:a,collectionName:r}=(e.searchString=convertQueryStringFromFormElements(t),e),r=await securedGetCall(`collection-table/${r}/finder/${a}/items/count?`+t),a=r?r._$isPrivateFilter:null;e.numberOfPages=getNumberOfPages(r.data,e.numberPerPage),e.currentPage=1,loadGroupData(e,a)}const convertQueryStringFromFormElements=e=>Object.values(e).map(e=>{if(e.name&&e.value)return encodeURIComponent(e.name)+"="+encodeURIComponent(e.value)}).filter(Boolean).join("&");function nextDataGroupPage(e){e.replacedElement.innerHTML="",e.currentPage+=1,loadGroupData(e)}function firstDataGroupPage(e){e.replacedElement.innerHTML="",e.currentPage=1,loadGroupData(e)}function lastDataGroupPage(e){e.replacedElement.innerHTML="",e.currentPage=e.numberOfPages,loadGroupData(e)}function previousDataGroupPage(e){e.replacedElement.innerHTML="",--e.currentPage,loadGroupData(e)}function loadMoreRecords(e){e.currentPage+=1,loadGroupData(e)}const prepareItemDataAndExternalQueryParam=(e,a,r,n)=>(e&&0<e.length&&e.forEach(e=>{var t=n.getAttribute(e);t&&r?(t=r[t])&&(a+=`&${e}=`+t):console.log("I do not have page item param or param key :>> ",e)}),a),prepareItemDataAndExternalQueryParamForTable=(e,t,a,r)=>{var n=t.includes("?");let l="";return n||(t+="?"),e&&0<e.length&&e.forEach(e=>{var t=r.getAttribute(e);t&&a&&((t=a[t])&&(l+=`&${e}=`+t))}),t=n?""+t+l:""+t+l.substr(1,l.length+1)},addDataGroupMarkerInfo=(e,n,l,i,s,d)=>{let o=[];e.map(e=>{const t=new google.maps.Marker({position:new google.maps.LatLng({lat:Number(e[l]),lng:Number(e[i])}),map:n});let a="<div>";e[s]&&(a+=`<h6>${e[s]}</h6>`),e[d]&&(a+=`<p>${e[d]}</p>`),a+="</div>";const r=new google.maps.InfoWindow({content:a});t.addListener("click",function(){clearInfoClickReference(o),r.open(t.get("map"),t),o[0]=r})})};function nextDataTablePage(e){e.currentPage+=1,loadDataList(e)}async function searchInDataTable(e,t,a=""){void 0!==t&&(t=t.target,e.searchString=convertQueryStringFromFormElements(t)),void 0!==e.searchString&&e.searchString&&a?(a.startsWith("?")&&(a=a.replace("?","&")),e.searchString=e.searchString+"&"+e.searchString+a):void 0===e.searchString&&a&&(a.startsWith("?")&&(a=a.replace("?","")),e.searchString=a);const{dataTable:r,searchString:n,finderId:l,collectionName:i,tbodyElement:s}=e;t=r.querySelector("thead").rows[0].cells.length;if(validateDataTableProps(l,i,t,s)){var a=await securedGetCall(`collection-table/${i}/finder/${l}/items/count?`+n),d=a?a._$isPrivateFilter:null;if(0<a.data)e.numberOfPages=getNumberOfPages(a.data,e.numberPerPage),e.currentPage=1,loadDataList(e);else{if(d)return s.innerHTML=`<tr><td  class="text-center" colspan="${t}">This data is private hence cannot be displayed</td></tr>`,void validatePaginationButton(1,1,r);s.innerHTML=`<tr><td  class="text-center" colspan="${t}"></td></tr>`,validatePaginationButton(1,1,r)}}else validatePaginationButton(1,1,r)}const validateDataTableProps=(e,t,a,r,n)=>{let l=!0;return t||(n.innerHTML=`<tr><td  class="text-center" colspan="${r}"> Please select a valid collection</td></tr>`,l=!1),l};async function loadDataList(e){var{currentPage:t,numberPerPage:a,filteredItemsUrl:r,fieldName:n,searchString:l,externalQueryParamKeys:i,dataTable:s}=e;let d=r;n||(r=(await getPageItemData())["itemData"],n=(t-1)*a,d=d+`?offset=${n}&limit=`+a,d=prepareItemDataAndExternalQueryParamForTable(i,d,r,s),l&&(d+="&"+l)),await renderDataTable(d,e),validatePaginationButton(e.numberOfPages,e.currentPage,e.dataTable)}const renderDataTable=async(t,a)=>{const{columnsMap:r,firstRowElements:n,tbodyElement:l,itemIds:i,collectionName:s}=a;if(l){var d="";l.innerHTML="",addTablePlaceholder(a.numberPerPage||1,n,l);let e=[];r&&(e=i||(await securedGetCall(t)).data,d+=await createTableRecords(e,r,n,s),l.innerHTML=d)}for(var[e,o]of dataTableStylesMap)selectorExists(`[id^="${e}"]`)||(e=`*[id^="${e}"] `+o,addStyle(e))},createTableRecords=async function(e,n,l,i=""){if(!e||!Array.isArray(e))return"";e=e.map(async e=>{var t,e=await getTableColumns(e,n,l,i);const a="TR"===l.tagName?l:"";let r="";return a&&(t=a.cloneNode(!0),r=elementAttribute(a,"id"),applyUserDefinedStyles(t,a,dataTableStylesMap)),`<tr ${setIdAttribute(r)}>${e}</tr>`});return(await Promise.all(e)).join("")},selectorExists=t=>{var a=getAllSelectors();for(let e=0;e<a.length;e++)if(a[e]==t)return!0;return!1},addStyle=e=>{let t=document.createElement("style");t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e)),document.getElementsByTagName("head")[0].appendChild(t)},getTableColumns=async(i,s,d,o="")=>{var e=Object.keys(s).map(async t=>{var e=d.cells,e=Object.values(e).find(e=>elementAttribute(e,"data-selected-column")===t);const a=void 0!==e&&"TD"===e.tagName?e:"",r=void 0!==e&&"TH"===e.tagName?e:"";let n="";a?(l=a.cloneNode(!0),n=elementAttribute(a,"id"),applyUserDefinedStyles(l,a,dataTableStylesMap)):r&&(l=r.cloneNode(!0),elementAttribute(r,"id"),applyUserDefinedStyles(l,r,dataTableStylesMap));var l=e?e.children:"";return t.includes('"')&&"functionType"in JSON.parse(t)?(e=getDerivedFieldData(t,i),`<td ${setIdAttribute(n)}>${setColumnDataIntoHtmlElement(e,l[0])}</td>`):"boolean"!==s[t]?"image"===s[t]||"file"===s[t]?renderFileColumnData(i,t,l[0]):"multi_image"===s[t]||"multi_file"===s[t]?renderMultiFileColumnData(i,t,l[0]):"updatedAt"===s[t]||"createdAt"===s[t]||"date"===s[t]?renderTimestampColumnData(i,t,l[0]):"object"!=typeof s[t]?"action"===s[t]?`<td ${setIdAttribute(n)}>${renderActionColumnData(i,t,l,o)}</td>`:("large_text"===s[t]?renderTableLargeTextColumn:renderTableBodyColumn)(i,t,l[0],n):await renderReferenceTypeData(i,s[t],t,l[0]):t in i?(e=i[t]?"Yes":"No",`<td ${setIdAttribute(n)}>${setColumnDataIntoHtmlElement(e,l[0])}</td>`):`<td ${setIdAttribute(n)}>${setColumnDataIntoHtmlElement(null,l[0])}</td>`});return(await Promise.all(e)).join("")},setIdAttribute=e=>e?`id=${e}-`+uuidv4():"",setColumnDataIntoHtmlElement=(e,t,a=!1)=>t?(setAttributeInColumnData(t),a?t.innerHTML=e||"":t.textContent=e||"",t.outerHTML):e||"",renderFileColumnData=(e,t,l)=>{const a=t?e[t]:"";let r="",n="",i="";if("object"!=typeof a||Array.isArray(a))a&&Array.isArray(a)&&(i=a.map(e=>{var t=e?e.isExternalUrl?e.url:"":e.key?IMAGE_SERVER_URL+e.key:"",e=e&&e.originalName?e.originalName:"",a=l?l.tagName:"";if(a&&"IMG"===a){const r=l.cloneNode(!0);return t?r.src=t:r.src,r.outerHTML}{const n=document.createElement("a");return n.href=t,n.innerText=e||t,l?(l.innerHTML=n.outerHTML,l.outerHTML):n.outerHTML}}));else{"object"==typeof a?(e=a.key,r=a.isExternalUrl?a.url:e?IMAGE_SERVER_URL+e:imageSrcUrl,n=a.originalName):"string"==typeof a&&a.startsWith("http")&&(r=a,n=a);t=l?l.tagName:"";if(t&&"IMG"===t){const s=l.cloneNode(!0);s.src=r||s.src,i=[s.outerHTML]}else{const d=document.createElement("a");d.href=r||r,d.innerText=n||r,i=l?(l.innerHTML=d.outerHTML,[l.outerHTML]):[d.outerHTML]}}return`<td>${i?i.join(" "):""} </td>`},renderMultiFileColumnData=(e,t,l)=>{let a="";return`<td>${(a=e[t]&&Array.isArray(e[t])?e[t].map(e=>{var t=e&&e.key?IMAGE_SERVER_URL+e.key:"",e=e&&e.originalName?e.originalName:"",a=l?l.tagName:"";if(a&&"IMG"===a){const r=l.cloneNode(!0);return t?r.src=t:r.src,r.outerHTML}{const n=document.createElement("a");return n.href=t,n.innerText=e||t,l?(l.innerHTML=n.outerHTML,l.outerHTML):n.outerHTML}}):a)?a.join(" "):""} </td>`},renderTimestampColumnData=(e,t,a)=>{e=e[t]?convertTimeStampToDate(e[t]):"";return`<td>${setColumnDataIntoHtmlElement(e,a)}</td>`},createFileAnchorTag=(e,t)=>{var a=e&&e.key?IMAGE_SERVER_URL+e.key:"",e=e&&e.originalName?e.originalName:"";const r=document.createElement("a");return r.href=a,r.innerText=e||a,t?(t.innerHTML=r.outerHTML,t.outerHTML):r.outerHTML},renderReferenceTypeFileData=(e,a)=>{let t="";return e&&Array.isArray(e)?`<td>${(t=e.map(t=>{if(t&&Array.isArray(t)){let e=t.map(e=>createFileAnchorTag(e,a));return e.join(" ")}return createFileAnchorTag(t,a)}))?t.join(" "):""} </td>`:"<td></td>"},renderReferenceTypeData=(e,t,a,r)=>{let{nestedFieldName:n,fieldType:l}=t.metaData||{};n||(i=((i=e._$belongsToMetaData)?i.refCollection:{})["collectionField"],n=i||void 0,"createdBy"===t.type&&(n="userName")),a.includes(".")||(a=a+"."+n);var i=parseValueFromData(e,a);return i&&"file"===l?renderReferenceTypeFileData(i,r):i?`<td>${setColumnDataIntoHtmlElement(i,r)}</td>`:"<td></td>"},renderLinkColumnData=(a,r,n="")=>{const l=r.cloneNode(!0);var i=elementAttribute(r,"id"),i=(i&&(i=i+"-"+a.uuid,l.setAttribute("id",i),applyUserDefinedStyles(r,l,dataTableStylesMap)),l.setAttribute("data-item-id",a.uuid),l.setAttribute("data-collection-item",JSON.stringify(a)),l.setAttribute("data-collection-id",n),window.document.getElementById("snipcart")),r=(void 0!==i&&null!=i&&l.classList.contains("snipcart-add-item")&&loadSnipcartItemData(l,a),elementAttribute(l,"data-path-field-name")),n=elementAttribute(l,"data-path-field-seo");if(r){const s=elementAttribute(l,"href");let e=r?parseValueFromData(a,r):"",t=(e=(e=e&&e.length?e.split(", "):"")[0],s.replace(r,e));n&&(i=n?parseValueFromData(a,n):"",i=slugify(i),t=t.replace(n,i)),l.setAttribute("href",t)}return l},renderActionColumnData=(t,e,a,r="")=>{const n=document.createElement("div");return Object.values(a).map(e=>{["pageCollection","session"].includes(e.getAttribute("data-path-collection-item-id-from"))?n.appendChild(e.cloneNode(!0)):(e=renderLinkColumnData(t,e,r),n.appendChild(e))}),n.innerHTML},renderTableLargeTextColumn=(e,t,a,r)=>{var n=!!e[t]&&htmlRegex.test(e[t]),e=e[t]||"";return`<td ${setIdAttribute(r)}>${setColumnDataIntoHtmlElement(e,a,n)}</td>`},renderTableBodyColumn=(e,t,a,r)=>{var n=a?.tagName,n=(n&&"A"===n&&!["pageCollection","session"].includes(element.getAttribute("data-path-collection-item-id-from"))&&(a=renderLinkColumnData(e,a)),e[t]||"");return`<td ${setIdAttribute(r)}>${setColumnDataIntoHtmlElement(n,a)}</td>`},setAttributeInColumnData=e=>{var t=e.cloneNode(!0);let a=elementAttribute(e,"id");return a=a||uuidv4(),applyUserDefinedStyles(t,e,dataTableStylesMap),e.hasAttribute("data-org-id")?e.setAttribute("id",elementAttribute(e,"data-org-id")+"-"+uuidv4()):(e.setAttribute("id",a+"-"+uuidv4()),e.setAttribute("data-org-id",a)),e},loadDataTable=async(n,l,i)=>{const{dataTable:s,fieldName:t,externalQueryParamKeys:d}=i;var e=s.querySelector("thead").rows[0].cells.length;const o=s.querySelector("[data-js=table-body]");if(validateDataTableProps(n,l,t,e,o)){let a=0,r=!1;var c=(await getPageItemData())["itemData"];if(n){let e=`collection-table/${l}/finder/${n}/items/count`,t=(e=prepareItemDataAndExternalQueryParamForTable(d,e,c,s),await searchQueryStringFromUrl());"undefined"!=typeof searchString&&searchString?e=t?(t.startsWith("?")&&!e.endsWith("/")&&(t=t.replace("?","&")),e+"&"+searchString+t):e+"&"+searchString:t&&(t.startsWith("?")&&!e.endsWith("/")&&(t=t.replace("?","&")),e+=t);n=await securedGetCall(e);a=n.data,i.numberOfPages=getNumberOfPages(a,i.numberPerPage),r=n?n._$isPrivateFilter:null}else if(t){let e=parseValueFromData(c,t);e=Array.isArray(e)?e:0<Object.keys(e).length?[e]:[],a=e.length,i.numberOfPages=1,i.filteredItemsUrl=`collection-table/${l}/itemList`,i.itemIds=e}if(i.tbodyElement=o,await setTableMetaData(i),0<a){n=await searchQueryStringFromUrl();n?searchInDataTable(i,void 0,n):loadDataList(i)}else{if(r)return o.innerHTML=`<tr><td class="text-center" colspan="${e}">This data is private hence cannot be displayed</td></tr>`,void validatePaginationButton(1,1,s);o.innerHTML=`<tr class="no-record-data-table"><td class="text-center" colspan="${e}"></td></tr>`,validatePaginationButton(1,1,s)}addDataTableDataToMap(i,i.dataTable)}else validatePaginationButton(1,1,s)},addTablePlaceholder=(t,e,a)=>{var r=localStorage.getItem("loadingIconKey");if("PLACEHOLDER"===r){var n=e.cells.length;for(let e=0;e<t;e++){const i=a.insertRow();for(let e=0;e<n;e++){const s=i.insertCell();s.innerHTML='<div class="drapcode-item-table"><div class="drapcode-col-12"><div class="drapcode-row"><div class="drapcode-col-12"></div></div></div></div>'}}}else{var l=e.cells.length;const d=a.insertRow();for(let e=0;e<l;e++){const o=d.insertCell();o.innerHTML="PLAIN_SPINNER"===r?'<div class="drapcode-spinner-plane drapcode-item-table"></div>':"CHASE_SPINNER"===r?'<div class="sk-chase drapcode-item-table"><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div><div class="sk-chase-dot"></div></div>':"BAR_SPINNER"===r?'<div class="drapcode-spinner-bar drapcode-item-table"><div class="rect1"></div><div class="rect2"></div><div class="rect3"></div><div class="rect4"></div><div class="rect5"></div></div>':"DOT_SPINNER"===r?'<div class="drapcode-spinner-dot drapcode-item-table"><div class="dot1"></div><div class="dot2"></div></div>':"FADING_CIRCLE_SPINNER"===r?'<div class="sk-fading-circle drapcode-item-table"><div class="sk-circle1 sk-circle"></div><div class="sk-circle2 sk-circle"></div><div class="sk-circle3 sk-circle"></div><div class="sk-circle4 sk-circle"></div><div class="sk-circle5 sk-circle"></div><div class="sk-circle6 sk-circle"></div><div class="sk-circle7 sk-circle"></div><div class="sk-circle8 sk-circle"></div><div class="sk-circle9 sk-circle"></div><div class="sk-circle10 sk-circle"></div><div class="sk-circle11 sk-circle"></div><div class="sk-circle12 sk-circle"></div></div>':"BOUNCE_SPINNER"===r?'<div class="drapcode-spinner-bounce drapcode-item-table"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>':""}}},setTableMetaData=async e=>{const{dataTable:t,tbodyElement:a}=e;var r=a.rows[0].cloneNode(!0);e.firstRowElements=r,e.columnsMap=getColumnsMetaData(t)},getColumnsMetaData=e=>{let n=[];var e=e.querySelector("[data-custom-js-row=collection-row]");return e&&(e=e?e.cells:[],Object.values(e).map(t=>{let a=elementAttribute(t,"data-selected-column");a.includes('"')&&(a=a.split("'").join('"'));var r=elementAttribute(t,"type");if(a&&("reference"===(n[a]=r)||"multi_reference"===r||"createdBy"===r||"belongsTo"===r)){let e=elementAttribute(t,"metadata");"createdBy"!==r||e||(e=null),n[a]={metaData:JSON.parse(e),type:r}}})),n},addDataTableDataToMap=async(e,t)=>{dataTablePaginationDataMap.set("ptdata_"+t.id,e)};function firstDataTablePage(e){e.currentPage=1,loadDataList(e)}function lastDataTablePage(e){e.currentPage=e.numberOfPages,loadDataList(e)}function previousDataTablePage(e){--e.currentPage,loadDataList(e)}const getAllSelectors=()=>{let t=[];var a=Array.from(document.styleSheets).filter(e=>!e.href||e.href.startsWith(window.location.origin));for(let e=0;e<a.length;e++){var r,n=a[e].rules||a[e].cssRules;for(r in n)"string"==typeof n[r].selectorText&&t.push(n[r].selectorText)}return t},elementAttribute=(e,t)=>e.getAttribute(t),renderLineChart=async(e,t,a,r)=>{e.innerHTML="",e.children=[];const n=elementAttribute(e,"data-series"),l=elementAttribute(e,"data-xaxis");if(a&&r){const i=await securedGetCall(`collection-table/${a}/finder/${r}/items`);if(0<i.data.length){const s=[],d=[];i.data.map(e=>{s.push(e[n]),d.push(e[l])});a={series:[{name:"Desktops",data:s}],chart:{height:t.chartHeight,type:"line",zoom:{enabled:t.chartZoom}},dataLabels:{enabled:t.chartDataLabel},stroke:{curve:t.strokeCurve||"straight"},title:{text:t.title||"-",align:"left"},grid:{row:{colors:["#f3f3f3","transparent"],opacity:.5}},xaxis:{categories:d}};const o=new ApexCharts(document.querySelector("#"+e.id),a);o.render()}}},renderAreaChart=async(e,t,a,r)=>{e.innerHTML="",e.children=[];const n=elementAttribute(e,"data-series"),l=elementAttribute(e,"data-xaxis");if(a&&r){const i=await securedGetCall(`collection-table/${a}/finder/${r}/items`);if(0<i.data.length){const s=[],d=[];i.data.map(e=>{s.push(e[n]),d.push(e[l])});a={series:[{name:"STOCK ABC",data:s}],chart:{type:"area",height:t.chartHeight,zoom:{enabled:t.chartZoom}},dataLabels:{enabled:t.chartDataLabel},stroke:{curve:t.strokeCurve||"straight"},title:{text:t.title||"-",align:"left"},subtitle:{text:t.subtitle||"-",align:"left"},labels:d,xaxis:{type:"datetime"},yaxis:{opposite:!0},legend:{horizontalAlign:"left"}};const o=new ApexCharts(document.querySelector("#"+e.id),a);o.render()}}},renderCircularGaugeChart=async(e,t,a,r)=>{e.innerHTML="",e.children=[];const n=elementAttribute(e,"data-series"),l=elementAttribute(e,"data-labels");if(a&&r){const i=await securedGetCall(`collection-table/${a}/finder/${r}/items`);if(0<i.data.length){const s=[],d=[];i.data.map(e=>{s.push(e[n]),d.push(e[l])});a={series:s,chart:{height:t.chartHeight,type:"radialBar"},plotOptions:{radialBar:{hollow:{size:`${t.hollowSize||"70"}%`}}},stroke:{dashArray:t.strokeDashArray||0,lineCap:""+(t.strokeLineCap||"round")},labels:d};const o=new ApexCharts(document.querySelector("#"+e.id),a);o.render()}}},renderHeatMapChart=async(e,t,a,r)=>{e.innerHTML="",e.children=[];const n=elementAttribute(e,"data-series-name"),l=elementAttribute(e,"data-series-data-x"),i=elementAttribute(e,"data-series-data-y");if(a&&r){const s=await securedGetCall(`collection-table/${a}/finder/${r}/items`);if(0<s.data.length){const d=[];s.data.map(t=>{const e=d.find(e=>e.name===t[n]);e?e.data.push({x:t[l],y:t[i]}):d.push({name:t[n],data:[{x:t[l],y:t[i]}]})});a={series:d,chart:{height:t.chartHeight,type:"heatmap"},dataLabels:{enabled:!1},colors:["#008FFB"],title:{text:t.chartTitle||"-"}};const o=new ApexCharts(document.querySelector("#"+e.id),a);o.render()}}},renderPieChart=async(e,t,a,r)=>{e.innerHTML="",e.children=[];const n=elementAttribute(e,"data-series"),l=elementAttribute(e,"data-labels");if(a&&r){const i=await securedGetCall(`collection-table/${a}/finder/${r}/items`);if(0<i.data.length){const s=[],d=[];i.data.map(e=>{s.push(e[n]),d.push(e[l])});a={series:s,chart:{width:t.chartWidth,type:t.chartType||"pie"},labels:d};const o=new ApexCharts(document.querySelector("#"+e.id),a);o.render()}}},renderAutoComplete=async(a,r,n,l)=>{if(r&&n){const i=(await securedGetCall(`collection-table/${r}/finder/${n}/items`))["data"];let t=[],e="Search...";0<i.length&&i.forEach(e=>{e&&(0<Object.keys(e).length?t.push(e[l]):t.push(e))}),0===t.length&&(e="No Data");const s=new autoComplete({selector:"#"+a.id,placeHolder:e,data:{src:t},resultItem:{highlight:!0},events:{input:{selection:e=>{e=e.detail.selection.value;s.input.value=e}}}})}},loadDataMapItems=async(e,t,a,r)=>{var n=elementAttribute(r,"data-map-lat"),l=elementAttribute(r,"data-map-long"),i=elementAttribute(r,"data-map-header"),s=elementAttribute(r,"data-map-description");r.innerHTML=`<div id="map-${r.id}" class="map"></div> <style>.map{
      height:100%;width:100%;
  }</style>`,t&&e&&(t=await securedGetCall(`collection-table/${t}/finder/${e}/items`),e=new google.maps.Map(document.getElementById("map-"+r.id),{zoom:Number(a),center:new google.maps.LatLng(Number(t.data[0][n]),Number(t.data[0][l]))}),0<t.data.length&&addMarkerInfo(t.data,e,n,l,i,s))},renderImageColumnData=(e,t,a)=>{const r=t?e[t]:"";let n="",l="";"object"==typeof r?(n=IMAGE_SERVER_URL+r.key,l=r.originalName):"string"==typeof r&&r.startsWith("http")&&(n=r,l=r);e=a?a.tagName:"";if(e&&"IMG"===e){const i=a.cloneNode(!0);return i.src=n||i.src,`<td>${i.outerHTML}</td>`}{const s=document.createElement("a");return s.href=n||n,s.innerText=l||n,a?(a.innerHTML=s.outerHTML,`<td>${a.outerHTML}</td>`):`<td>${s.outerHTML}</td>`}};
//# sourceMappingURL=dataLoader.js.map